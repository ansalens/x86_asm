#  Compiling a C Program: Behind the Scenes

- Compilation turns our source code into machine code which can be executed by our machine.
- This is the process of compiling a C program:
![compile](scrs/compilation.png)

- We can get each temporary file which is generated by `gcc` during compilation process with:
```sh
$ gcc -Wall -save-temps prog.c -o prog
```

- Notice that we get all intermediate files: `prog.i  prog.o  prog.s` 

## Preprocessing

- Preprocessing is a first step in this process.
- __It removes comments, expands macros, expands included files, and involves conditional compilation.__
- Restrict `gcc` to output only pre-processed file:

```sh
$ gcc -E prog.c -o prog.i
```

## Compiling

- Next step is compiling `prog.i` which we got from preprocessing step and producing assembly equivalent `prog.s`.
- This is a step where in-line assembly is processed.

- Use `gcc` to generate only assembly equivalent code:

```sh
$ gcc -S prog.c -fverbose-asm -o prog.s
```

## Assembling

- This step takes `prog.s` and turns it into object file `prog.o` which will contain machine code.
- No external functions are resolved yet (such as printf).
- This is first step in generating __ELF__ file.


## Linking

- Final step in compilation process.
- It knows where every function is and resolves them accordingly (so functions like printf can be called).
- It also adds some extra code which is needed for starting and ending our program (size of object file increases).

- __All these steps are done automatically via `gcc`.__


---

Source: https://www.geeksforgeeks.org/compiling-a-c-program-behind-the-scenes/
